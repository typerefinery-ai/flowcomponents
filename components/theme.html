<script total>

exports.id = 'typerefinery_theme';
exports.name = 'Theme';
exports.icon = 'fa fa-code';
exports.author = 'Team TypeRefinery ';
exports.group = 'TypeRefinery';
exports.version = '1';

exports.config = { title: exports.name, version: exports.version, outputs: 1, code: '' }
exports.inputs = [{ id: 'input', name: 'Input' }];
exports.outputs = [{ id: 'output', name: 'Output' }];

exports.meta = { settingswidth: 1200 };

exports.make = function(instance, config) {
	var fn;
	instance.message = function($) {
		if (fn) {
			try {
				var send = data => $.send('output', data);
				fn($.data, instance, $, $, F.require, send, $.repo, $.vars, $.data);
			} catch (e) {
				$.throw(e);
				$.destroy();
			}
		}
	};
	instance.configure = function() {
		if (config.title === "") {
			config.title = exports.name;
		}
		config.version = exports.version;

		instance.outputs = [];
		for (let i = 1; i <= config.outputs; i++)
			instance.outputs.push({ id: 'output' + (i === 1 ? '' : i), name: 'Output #' + i });
		instance.save();
		try {
			if (config.code) {
				instance.status(1);
				fn = new Function('value', 'instance', '$', 'message', 'require', 'send', 'repo', 'vars', 'data', config.code);
			} else {
				instance.status(0);
				fn = null;
			}
		} catch (e) {
			fn = null;
			instance.throw('Code: ' + e.message);
		}
	};
	instance.close = function() {
		fn = null;
	};

	instance.configure();

};
</script>

<readme>
	Add theme to your flow.
</readme>

<settings>
	<div class="padding">
		<div data---="input__?.title__text"><b>Title</b></div>
		<div class="ui-input-label">Theme:</div>
		<div data---="codemirror__?.code__type:javascript;minheight:300;parent:auto;margin:60;tabs:true;trim:true" class="m"></div>
	</div>
</settings>

<body>
	<header>
		<i class="ICON"></i><b class="monospace" data-bind="CONFIG.title__text__empty"></b>
		<div><small><i>NAME v<span data-bind="CONFIG.version__text__empty"></span></i></small></div>
	</header>
</body>