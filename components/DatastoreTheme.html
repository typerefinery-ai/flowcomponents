<script total>
    exports.name = 'Datastore Theme';
    exports.icon = 'fa fa-code';
    exports.author = 'Total Avengers';
    exports.group = 'TypeRefinery';
    exports.version = '1';
    exports.config = {themeid: ''};
    exports.inputs = [{ id: 'input', name: 'Input' }];
    exports.outputs = [{ id: 'output', name: 'Output' }];
    exports.meta = { settingswidth: 1200 };
    exports.make = function(instance, config) {
        instance.message = async function($) {
            const endpoint = 'http://127.0.0.1:8000/datastore/theme';
            var output;
            const res = await fetch(endpoint);
            const res_data = await res.json();
            output = res_data.map(el => ({id: el.themeid, name: `${el.label} (${el.themeid},${el.theme.substr(12)})`})); // dropdown data
            const theme = res_data.find(el => el.themeid === config.themeid)
            if(theme) instance.send('output',JSON.parse(theme.theme));
            instance.call = async function(data, answer) {
                answer(output);
            };
        };
        instance.configure = function(el) {
        };
        instance.close = function() {
        };
        instance.configure();
    };
</script>
<readme>
</readme>
<script>
    // datastoretheme is the name of your component in lower-case
    ON('configure_datastoretheme', function(data) {
        data.call(function(response) {
            SET('%themeidList', response);
        });
    });
</script>
<settings>
    <div class="padding">
        <div data---="input__?.themeid__dirsource:%themeidList;dirraw:1;placeholder:Choose a theme;dirempty:No theme" class="m"><b>Theme</b></div>
    </div>
</settings>
<body>
    <header>
        <i class="ICON"></i>NAME
    </header>
</body>
